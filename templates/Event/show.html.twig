{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('event') }}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="" />
    {{ encore_entry_link_tags('map') }}
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.css"/>


{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('event') }}
    {{ encore_entry_script_tags('map') }}
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.js"></script>
{% endblock %}

{% block title %}{{ event.title }}{% endblock %}

{% block body %}
    <div id="content-header" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner bg-dark" role="listbox">
            <div class="carousel-item active">
                <img style="opacity:0.2" class="first-slide" src="https://l1visible.com/wp-content/uploads/2018/10/FORET.jpg" alt="First slide">
                <div class="container">
                    <div class="carousel-caption d-none d-md-block text-left">
                        <h1 class="display-2 d-inline-block"><span class="badge badge-primary">{{ event.dateBegin|date('d') }}</span></h1>
            			<h3 class="display-4 d-inline-block"><span class="badge">{{ event.dateBegin|date('F')|trans|upper }}</span></h3>
                        <h1>{{ event.title }}</h1>
                        <div class="text-white font-italic">
                            {{ 'owp_event_show_field_published_at'|trans ~ ' ' ~ event.createAt|date('d/m/Y H:i:s') }}
                            {{ 'owp_event_show_field_updated_at'|trans ~ ' ' ~ event.updateAt|date('d/m/Y H:i:s') }}
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    {% if is_granted('ROLE_WEBMASTER') %}
    <div class="admin-quick-edit">
        <a href="{{ path('admin_app_event_edit', {'id': event.id}) }}" class='btn btn-outline-light' href=""><i class="fa fa-edit"></i> {{ 'owp_event_show_button_update'|trans }}</a>
        <a href="{{ path('admin_app_event_delete', {'id': event.id}) }}" onclick="return confirm('Êtes vous sûr de vouloir supprimer cette actualité ?');" class='btn btn-outline-light' href=""><i class="fa fa-trash"></i> {{ 'owp_event_show_button_delete'|trans }}</a>
    </div>
    {% endif %}

    <div class="container my-4">
        <div class="mt-2">{{ event.content|raw }}</div>

        <div class="row">
            <div class="col-7">
                <h2 class="my-4">{{ 'owp_event_show_title_main_information'| trans }}</h2>
                <table>
                    <tr><td class="font-weight-bold pr-4">{{ 'owp_event_show_field_date'|trans }}</td><td>{{ period(event.dateBegin, event.dateEnd)|capitalize }}</td></tr>
                    <tr><td class="font-weight-bold pr-4">{{ 'owp_event_show_field_event_type'|trans }}</td><td>{{ event.eventType.label|capitalize }}</td></tr>
                    {% if event.organizer %}<tr><td class="font-weight-bold">{{ 'owp_event_show_field_organizer'|trans  }}</td><td>{{ event.organizer|capitalize }}</td></tr>{% endif %}
                </table>

                <h2 class="my-4">{{ 'owp_event_show_title_location'| trans }}</h2>
                <b>{{ event.locationTitle | capitalize }}</b>
                {{ event.locationInformation | raw }}
                {% if event.latitude is not empty and event.longitude is not empty %}
                    <div class="mt-4">
                        <div id="map" lat="{{ event.latitude }}" lon="{{ event.longitude }}"></div>
                    </div>
                {% endif %}
            </div>

            <div class="col-5">
                {% if event.circuits|length > 0 %}
                    <h2 class="my-4">{{ 'owp_event_show_title_circuit'| trans }}</h2>
                    <table id="event-entries" class="table table-striped">
                        <thead class="bg-primary text-white">
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">{{ 'owp_event_show_field_circuit_name'|trans }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for circuit in event.circuits %}
                                <tr>
                                    <th scope="row">{{ loop.index0 }}</th>
                                    <td>{{ circuit.label }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% endif %}

                <h2 class="my-4">{{ 'owp_event_show_title_entries'| trans }}</h2>
                {% if not event.allowEntries %}
                    {{ 'owp_event_entries_not_allowed'|trans }}
                {% else %}
                    {% if not event.dateEntries or event.dateEntries|date('U') > 'now'|date('U') %}
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-entries">
                            {{ 'owp_event_show_button_register'|trans }}
                        </button>

                        <div class="modal fade" id="modal-entries" tabindex="-1" role="dialog" aria-labelledby="modal-entries-label" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="modal-entries-label">{{ 'owp_event_show_title_modal_entries'|trans }}</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-link" data-dismiss="modal">{{ 'owp_event_show_button_cancel'|trans }}</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    <table id="event-entries" class="table table-striped">
                        <thead class="bg-primary text-white">
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">{{ 'owp_event_show_field_entries_first_name'|trans }}</th>
                                <th scope="col">{{ 'owp_event_show_field_entries_last_name'|trans }}</th>
                                {% if event.circuits|length > 0 %}<th scope="col">{{ 'owp_event_show_field_entries_circuit'|trans }}</th>{% endif %}
                                <th scope="col">{{ 'owp_event_show_field_entries_comment'|trans }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row">1</th>
                                <td>Mark</td>
                                <td>Otto</td>
                                <td>@mdo</td>
                            </tr>
                            <tr>
                                <th scope="row">2</th>
                                <td>Mark</td>
                                <td>Otto</td>
                                <td>@mdo</td>
                            </tr>
                        </tbody>
                    </table>
                {% endif %}
            </div>
        </div>

        <h2 class="my-4">{{ 'owp_event_show_title_comment' | trans }}</h2>
        {% include '@FOSComment/Thread/async.html.twig' with {'id': 'event:' ~ event.id} %}
    </div>
{% endblock %}
